name: Automated Commit

on:
  push:
    branches: [main]

  schedule:
    - cron: '0 * * * *'

  workflow_dispatch:

permissions:
  contents: write

jobs:
  update_commit:
    runs-on: self-hosted

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          ref: main
          persist-credentials: true
          fetch-depth: 0

      - name: Update Timestamp File
        run: |
          current_time=$(date '+%Y-%m-%d %H:%M:%S')
          echo "Updated on $current_time" > TIMESTAMP.txt

      - name: Setup Git Configuration
        run: |
          git config user.email "nattawatt.ho30@outlook.co.th"
          git config user.name "RealNattawattHongthong"

      - name: Commit Changes
        run: |
          git add TIMESTAMP.txt
          git commit -m "Auto update ‚è∞" || echo "No changes to commit"

      - name: Rebase & Push
        run: |
          git pull origin main --rebase
          git push origin main
